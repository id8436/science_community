{% extends 'utility/common.html' %}

{% block content %}

<h2>레이텍 렌더기</h2>
<div class="row mb-3">
  <!-- 왼쪽 입력 영역 -->
  <div class="col-md-6">
    <label for="latex_origin" class="form-label">원문</label>
    <textarea
      id="latex_origin"
      name="latex_origin"
      class="form-control latex-input"
      rows="10"
      placeholder="latex 원문을 입력하세요."
      maxlength="100000"
    ></textarea>
    <button id="renderBtn" class="btn btn-primary mt-2">미리보기</button>
  </div>

  <!-- 오른쪽 미리보기 영역 -->
  <div class="col-md-6">
    <label class="form-label">PDF 미리보기</label>
    <iframe
      id="pdfPreview"
      style="width: 100%; height: 500px; border: 1px solid #ccc;"
    ></iframe>
  </div>
</div>



<script>
function getCookie(name) {
  let cookieValue = null;
  if (document.cookie && document.cookie !== '') {
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
      const cookie = cookies[i].trim();
      // "name="으로 시작하는 쿠키 찾기
      if (cookie.substring(0, name.length + 1) === (name + '=')) {
        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
        break;
      }
    }
  }
  return cookieValue;
}
</script>

<script>
document.getElementById("renderBtn").addEventListener("click", async function () {
  const latex = document.getElementById("latex_origin").value;

  const response = await fetch("/render-latex/", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-CSRFToken": getCookie("csrftoken"),
    },
    body: JSON.stringify({ latex: latex }),
  });

  if (response.ok) {
    const data = await response.json();
    document.getElementById("pdfPreview").src = data.pdf_url + "?t=" + new Date().getTime();
  } else {
    alert("PDF 생성 실패!");
  }
});
</script>

{% endblock content %}
